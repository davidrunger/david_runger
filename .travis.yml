language: ruby
os: linux
dist: bionic
cache:
  bundler: true
  directories:
    - node_modules
rvm:
  - "2.7.1"
services:
  - memcached
  - postgresql
  - redis
addons:
  chrome: stable
  postgresql: "9.6"
env:
  global:
    - RAILS_ENV=test
    - NODE_ENV=test
    - DISABLE_SPRING=1
    - SECRET_KEY_BASE=0af8c0e49e9259f2d777cfcd121d8540cee914c34b0abf08dd825bdee47c402daf9f2b9b74a9fff6f88ed95257ae39504e0d59c66400413b0cf7d29079c6358b
before_install:
  - . $HOME/.nvm/nvm.sh
  - nvm install 12.13.0
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.19.1
  - export PATH="$HOME/.yarn/bin:$PATH"
  - CHROMEDRIVER_VERSION=$(wget -qO- https://chromedriver.storage.googleapis.com/LATEST_RELEASE)
  - curl -o tmp/chromedriver.zip https://chromedriver.storage.googleapis.com/$CHROMEDRIVER_VERSION/chromedriver_linux64.zip
  - unzip -d "$HOME/bin/" tmp/chromedriver.zip
script:
  - ruby --version && [ "$(ruby --version | cut -c1-11)" == 'ruby 2.7.1p' ]
  - bundle --version && [ "$(bundle --version | cut -c1-20)" == 'Bundler version 2.1.' ]
  - node --version && [ "$(node --version)" == 'v12.13.0' ]
  - yarn --version && [ "$(yarn --version)" == '1.19.1' ]
  - chromedriver --version # print chromedriver version, but don't check it, because it changes
  - bin/pallets --verbose -r ./bin/orchestrate-tests.rb
notifications:
  email:
    on_success: never
    on_failure: always
deploy:
  provider: heroku
  # This token will expire 2021-02-15.
  # To make a new one, see: https://docs.travis-ci.com/user/deployment/heroku/
  api_key:
    secure: jwfsFVVUeNaVuCkZ0Wr063h0JRc374WCn2/JaZqm7OEtTvcyEMTA4tC05pjY8dyo9tSHKyC0R4ppmW5kRSUGi5kRXLIsCJs6S5sNA+o3qdvF1mVjgi3KnbdYbIoeDGjmZ5CGdb245WQv21AJkM7XUQYS8lBVgmSjP351+TKn/ErZQD0h/T+eyQdBZgLeL/Dqg87UleqZdjgH1UizpBw9Y7cCU6unOoaoHx0huW6cqVpcnTtZI25yrXdel16Tt3X35u5H2SErbVd+BvfShMUKYQNKzoIkkYeHX9zXfJxTddj4He3C8Pr5NSjq3fHlUQW8g+rz8krsuc/3WBn21wAlIXOMld3RS30rUrZsT8UbLgm7Oy/BugG+Oclfk8/+lpwm+CuU5DttO5DAPkKYVmAGvIa2wmkO/kg3xb1wiROHIYuXTWaHZU6EoOeBq7ilANJFn+tgnQQh6QipI810QE4ZfRzgPYQpXYK5IL3ZhxBJ8n6iLLCUA9JpJhluXsflG/gliiNsxat3JjLqXlRpLxahiRCOnigndrKqZeaJEupZ5XSJrwPVXJ3iUNdp88/DDmrLB5xNLlseNwKJZPwWCuz8lZwVYWaD05B2cwRfC0Os25Pgn86jC/dAhbcin/tu6BHrmscMjZkPsoe1Q2wBsHlpsZM0+/DBoiRR1oytOB0RJQw=
  strategy: git
  app: davidrunger
