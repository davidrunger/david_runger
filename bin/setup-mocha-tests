#!/usr/bin/env node

/* eslint-disable no-console */

const fs = require('fs');
const { sync } = require('glob');
const { join } = require('path');

// eslint-disable-next-line global-require, import/no-dynamic-require
const indexFileContents =
  sync(join(__dirname, '..', 'spec', '**', '*spec.js')).
    map(specPath => {
      let cleanedPath = specPath;
      cleanedPath = cleanedPath.replace(join(__dirname, '..', 'spec', 'javascript/'), '');
      cleanedPath = cleanedPath.replace('.js', '');
      return `import '${cleanedPath}';`;
    }).
    concat("import 'mocha_runner.html';").
    join('\n');

const specIndexPath = join(__dirname, '..', 'spec', 'javascript', 'packs', 'spec_index.js');
fs.writeFileSync(specIndexPath, `${indexFileContents}\n`);

console.log('NOTE: For the tests to work, you must first run');
console.log('NODE_ENV=test bin/webpack-dev-server');
console.log('(maybe in another tab).');
